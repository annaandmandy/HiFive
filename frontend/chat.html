<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Research Dashboard - Chat with Rhett</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="styles_chat.css">
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <h1 class="logo">Research Dashboard</h1>
            <ul class="nav-menu">
                <li><a href="index.html">Home</a></li>
                <li><a href="research.html">Research Trends</a></li>
                <li><a href="people.html">Researchers</a></li>
                <li><a href="projects.html">Projects</a></li>
                <li><a href="chat.html" class="active">Chat with Rhett</a></li>
            </ul>
        </div>
    </nav>

    <main class="chat-main">
        <!-- Welcome Container with Big Rhett -->
        <div class="rhett-welcome-container" id="rhett-welcome">
            <div class="rhett-welcome-content">
                <img src="assets/rhett-removebg-preview.png" alt="Rhett the Mascot" class="rhett-image-large">
                <h2 class="rhett-greeting">Heya! I'm Rhett üêæ</h2>
                <p class="rhett-subtitle">Your Terrier research scout‚Äîlet's turn AI trends into stories, tail wags, and action steps.</p>
                <div class="example-questions">
                    <p class="example-label">Give me something to sniff out:</p>
                    <button class="example-chip" data-query="What are the trending topics in Large Language Models?">Large Language Models trends</button>
                    <button class="example-chip" data-query="Tell me about AI Safety research">AI Safety research</button>
                    <button class="example-chip" data-query="Who are the top researchers in Computer Vision?">Computer Vision experts</button>
                </div>
            </div>
        </div>

        <!-- Chat Messages Container -->
        <div class="chat-messages-wrapper" id="chat-wrapper" style="display: none;">
            <div class="chat-messages" id="chat-messages">
                <!-- Messages will be added here dynamically -->
            </div>
        </div>

        <!-- Chat Input at Bottom -->
        <div class="chat-input-container">
            <div class="chat-input-wrapper">
                <input
                    type="text"
                    id="chat-input"
                    placeholder="Ask Rhett to sniff out AI topics, trends, or collaborators..."
                    class="chat-input"
                    autocomplete="off"
                >
                <button id="send-btn" class="btn btn-primary send-btn">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="22" y1="2" x2="11" y2="13"></line>
                        <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                    </svg>
                </button>
            </div>
            <div class="chat-footer">
                <small>Powered by OpenAI & OpenAlex</small>
            </div>
        </div>

        <!-- Suggested Researchers Sidebar -->
        <aside class="researchers-sidebar" id="researchers-sidebar" style="display: none;">
            <div class="sidebar-header">
                <h3>Related Researchers</h3>
                <button class="close-sidebar" id="close-sidebar">&times;</button>
            </div>
            <div class="sidebar-content" id="suggested-researchers">
                <!-- Researcher cards will be added here -->
            </div>
        </aside>

        <!-- Reopen Sidebar Button (shown when sidebar is closed) -->
        <button class="reopen-sidebar-btn" id="reopen-sidebar" style="display: none;">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                <circle cx="9" cy="7" r="4"></circle>
                <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
            </svg>
            <span class="researcher-count" id="researcher-count"></span>
        </button>
    </main>

    <footer>
        <p>&copy; 2025 Research Dashboard | Powered by OpenAlex & OpenAI</p>
    </footer>

    <script type="module" src="script.js"></script>
    <script type="module">
        import { initChatPage } from './script.js';
        import { initRSTIChat, addBinaryChoiceButtons } from './rsti-chat.js';

        // Check if starting RSTI-based chat
        const rstiStartChat = localStorage.getItem('RSTI_START_CHAT');

        if (rstiStartChat === 'true') {
            // Remove the flag
            localStorage.removeItem('RSTI_START_CHAT');

            // Initialize RSTI chat mode
            initRSTIChat().then((handler) => {
                if (handler) {
                    // Add binary choice buttons
                    addBinaryChoiceButtons(async (choice) => {
                        const result = await handler.handleChoice(choice);

                        if (result.isComplete && result.topics && result.topics.length > 0) {
                            // Mark RSTI chat as complete
                            localStorage.setItem('RSTI_CHAT_COMPLETE', 'true');
                            localStorage.setItem('RSTI_RECOMMENDED_TOPICS', JSON.stringify(result.topics));

                            // Update the example chips with recommended topics
                            updateExampleChips(result.topics);

                            // Switch to normal chat mode
                            initChatPage();
                        }

                        return result;
                    });
                }
            });
        } else {
            // Normal chat mode
            initChatPage();

            // Check if we have recommended topics to show
            const recommendedTopics = localStorage.getItem('RSTI_RECOMMENDED_TOPICS');
            if (recommendedTopics) {
                try {
                    const topics = JSON.parse(recommendedTopics);
                    if (topics && topics.length > 0) {
                        updateExampleChips(topics);
                    }
                } catch (e) {
                    console.error('Error parsing recommended topics:', e);
                }
            }
        }

        function updateExampleChips(topics) {
            const chips = document.querySelectorAll('.example-chip');
            topics.forEach((topic, index) => {
                if (chips[index]) {
                    chips[index].textContent = topic;
                    chips[index].setAttribute('data-query', `Tell me about ${topic}`);
                }
            });
        }
    </script>
</body>
</html>
